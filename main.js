import { state, initCanvas, createEmptyFrames, draw, loop } from "./animationEngine.js"; import { ui, initUI, rebuildTimelineUI, updateFrameSelectionUI, loadFrameOffsetsToInputs, setupInitialFrames, } from "./ui.js"; window.addEventListener("DOMContentLoaded", () => { initCanvas(); initUI(); setupInitialFrames(); ui.imageInput.addEventListener("change", (e) => { const file = e.target.files[0]; if (!file) return; const img = new Image(); img.onload = () => { state.characterImage = img; draw(ui.styleSelect.value); }; img.src = URL.createObjectURL(file); }); ui.buildTimelineBtn.addEventListener("click", () => { const count = Math.max(1, Math.min(60, Number(ui.frameCountInput.value))); createEmptyFrames(count); state.activeFrameIndex = 0; ui.currentFrameLabel.textContent = 1; rebuildTimelineUI(onFrameClick); loadFrameOffsetsToInputs(); draw(ui.styleSelect.value); }); function onFrameClick(index) { state.activeFrameIndex = index; ui.currentFrameLabel.textContent = index + 1; updateFrameSelectionUI(); loadFrameOffsetsToInputs(); draw(ui.styleSelect.value); } ui.saveFrameBtn.addEventListener("click", () => { if (!state.frames[state.activeFrameIndex]) return; state.frames[state.activeFrameIndex].offsetX = Number(ui.offsetXInput.value); state.frames[state.activeFrameIndex].offsetY = Number(ui.offsetYInput.value); draw(ui.styleSelect.value); }); ui.fpsInput.addEventListener("change", () => { const fps = Math.max(1, Math.min(60, Number(ui.fpsInput.value))); state.frameDuration = 1000 / fps; }); ui.styleSelect.addEventListener("change", () => { draw(ui.styleSelect.value); }); ui.playBtn.addEventListener("click", () => { if (state.frames.length === 0) return; if (state.isPlaying) return; state.isPlaying = true; state.lastTime = performance.now(); requestAnimationFrame((t) => loop(t, ui.styleSelect.value, (frameIndex) => { state.activeFrameIndex = frameIndex; ui.currentFrameLabel.textContent = frameIndex + 1; updateFrameSelectionUI(); loadFrameOffsetsToInputs(); }) ); }); ui.stopBtn.addEventListener("click", () => { state.isPlaying = false; }); });
